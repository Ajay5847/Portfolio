import React from "react";
import { useState } from "react";
import { useEffect } from "react";
import AntDesign from "./1.Crypto-Converter-Components/AntDesign";

const App = () => {
  const apiUrl = `https://api.coingecko.com/api/v3/exchange_rates`;

  const firstValue = "Bitcoin";
  const secondValue = "Ether";
  const [cryptoList, setCryptoList] = useState([]);
  const [defaultFirstValue, setDefaultFirstValue] = useState(firstValue);
  const [defaultSecondValue, setDefaultSecondValue] = useState(secondValue);
  const [inputValue, setInputValue] = useState(0);
  const [defaultConversion, setdefaultConversion] = useState(
    "1 Bitcoin = 2 Ether"
  );
  useEffect(() => {
    fetchData();
  });

  useEffect(() => {
    //console.log(inputValue, defaultFirstValue, defaultSecondValue);
    if (cryptoList.length == 0){
        return;
    }
    else {
      const firstObj = cryptoList.find((item) => {
        return item.value === defaultFirstValue;
      });
      const secondObj = cryptoList.find((item) => {
        return item.value === defaultSecondValue;
      });
      const updatedValue = ((secondObj.rates)*inputValue/(firstObj.rates)).toFixed(4);
      setdefaultConversion(`${inputValue} ${defaultFirstValue} = ${updatedValue} ${defaultSecondValue}`)
    }
  }, [inputValue, defaultFirstValue, defaultSecondValue,cryptoList]);

  async function fetchData() {
    const response = await fetch(apiUrl);
    const jsonData = await response.json();

    const actData = jsonData.rates;
    // actData is an Array of objects so we use Objects.entries() method

    const tempArray = [];
    Object.entries(actData).forEach((item) => {
      const tempObj = {
        value: item[1].name,
        label: item[1].name,
        rates: item[1].value,
      };
      tempArray.push(tempObj);
    });

    setCryptoList(tempArray);
  }

  function handleInput(e) {
    setInputValue(e);
  }

  function handleS1(e) {
    setDefaultFirstValue(e);
  }

  function handleS2(e) {
    setDefaultSecondValue(e);
  }

  return (
    <div>
      <AntDesign
        names={cryptoList}
        defaultFirstValue={defaultFirstValue}
        defaultSecondValue={defaultSecondValue}
        handleInput={handleInput}
        handleS1={handleS1}
        handleS2={handleS2}
        defaultConversion={defaultConversion}
      />
    </div>
  );
};

export default App;





// index-css-code





* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: black;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

.container {
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card {
  border: 2px solid black;
  scale: 1;
}

.input-field::placeholder {
  color: rgb(55, 53, 53);
}

.price-tag {
  margin-top: 20px;
  display: flex;
  justify-content: space-between;
}

.display {
  margin-top: 20px;
  border-radius: 10px;
}

p {
  font-weight: bold;
  padding: 4px;
}

.selector::options {
  font-weight: bold;
}

.coin {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  scale: 2;
}